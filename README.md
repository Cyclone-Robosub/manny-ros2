# Systems Architecture 2026
The new and improved codebase for 2026 (and hopefully beyond)!

This will contain the ROS nodes, topics, etc. developed by the Systems Architecture subteam of UC Davis Cyclone Robosub. It will also contain C code auto-generated by Matlab to be used in the robot control system.

## Overview:

### Nodes:
TODO: List of **all** nodes with topics that they publish from/listen to.

### Custom message types:
in `Position.msg` file:

```cpp
float32[6] position # [x, y, z, roll, pitch, yaw]
```

in `Pwms.msg` file:

```cpp
int32[8] pwms
```

in `State.msg` file:

```cpp
Position position 
Position velocity 
geometry_msgs/Vector3 acceleration # [x, y, z], type provided by ROS
```

in `Control_mode.srv` file:

```cpp
bool request_mode # matlab = 1, manual = 0
--
bool status 
```

in `Gamepad.msg` file: see https://github.com/Cyclone-Robosub/Web_controller/blob/main/readme.md for details
    
    ```cpp
    float32 x
    float32 y
    float32 rise
    float32 sink
    float32 yaw
    float32 pitch
    ```
### Topics
1. `pwm_cmd` - instantaneous PWM from the mux that is sent the thrusters: Pwms.msg type
2. `pwm_cli` - PWM from manual command line: Pwms.msg type
3. `pwm_ctrl` - PWM from matlab controller: Pwms.msg type
4. `waypoint` - instantaneous waypoint: Position type
5. `state` - instantaneous best state estimate,  typically output by sensor fusion: 
    1. position: list of 6 floats (x, y, z, roll, pitch, yaw)
    2. velocity: list of 6 floats (x, y, z, roll, pitch, yaw)
    3. acceleration: list of 3 floats (x, y, z)
6. `current_control_mode` - Which control mode the robot is currently in (designed to be read by Jason's stuff)

1. Vision Related Topics: TBD
    - seen_objects, includes vector_to_object - list of the objects the camera system has identified with meta data like distances, confidences
    - raw_image - raw image files
    - vision_velocity - velocity estimate from vision algorithms
2. `ps5_controller` - Remote Control Related Topics (Gamepad.msg)
    
3. DVL related topics
    - sensor_ctrl - for all sensors # Probably deprecated
    - ~~sensor_toggles~~ - for all sensors
    - dvl_data: Position type
4. Battery
- bms - battery data: voltage (float32), current (float32)

### Services & Actions

1. `is_matlab_control_mode` - service return is new mode: Bool (true=matlab, false=manual)

2. `[sensor]_settings` - service containing sensor settings (vision, DVL, maybe BMS)
    1. one of these services per sensor. Each has unique data corresponding to individual sensor specs, plus a toggle field
3. TBD action about updating waypoints
